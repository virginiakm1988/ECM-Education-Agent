<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Chatbot - Multi-LLM Support</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="rag_system.js"></script>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1><i class="fas fa-robot"></i> EOP Educational Agent</h1>
                <button class="settings-btn" id="settingsBtn">
                    <i class="fas fa-cog"></i>
                </button>
            </div>
        </header>

        <!-- Settings Panel -->
        <div class="settings-panel" id="settingsPanel">
            <div class="settings-content">
                <h3>Settings</h3>
                <div class="setting-group">
                    <label for="llmProvider">LLM Provider:</label>
                    <select id="llmProvider">
                        <option value="gemini">Google Gemini</option>
                        <option value="openai">OpenAI GPT</option>
                        <option value="anthropic">Anthropic Claude</option>
                        <option value="nvidia-nim">NVIDIA NIM</option>
                        <option value="ollama">Ollama (Local)</option>
                    </select>
                </div>
                <div class="setting-group">
                    <label for="apiKey">API Key:</label>
                    <input type="password" id="apiKey" placeholder="Enter your API key">
                    <small>Your API key is stored locally and never sent to our servers</small>
                </div>
                <div class="setting-group" id="nimEndpointGroup" style="display: none;">
                    <label for="nimEndpoint">NIM Endpoint URL (Optional):</label>
                    <input type="text" id="nimEndpoint" placeholder="Leave empty to use NVIDIA's integrate API">
                    <small>Leave empty to use NVIDIA's hosted API, or enter your custom NIM endpoint</small>
                </div>
                <div class="setting-group">
                    <label for="model">Model:</label>
                    <select id="model">
                        <option value="gemini-pro">Gemini Pro</option>
                    </select>
                </div>
                <div class="setting-group">
                    <label for="temperature">Temperature:</label>
                    <input type="range" id="temperature" min="0" max="1" step="0.1" value="0.7">
                    <span id="temperatureValue">0.7</span>
                </div>
                <div class="setting-group">
                    <label for="systemPrompt">System Prompt:</label>
                    <select id="systemPrompt">
                        <option value="default">Default Assistant</option>
                        <option value="ecm-main">EOP/ECM Education Agent</option>
                        <option value="eop-paper-expert">EOP Paper Expert</option>
                        <option value="ecm-explanation">ECM Significance Explanation</option>
                        <option value="ecm-development">Development Guidance</option>
                        <option value="ecm-analysis">Repository Analysis</option>
                        <option value="ecm-reorganization">Script Reorganization</option>
                        <option value="ecm-template">Template Generation</option>
                    </select>
                    <small>Choose a specialized prompt for your research needs</small>
                </div>
                <div class="setting-group">
                    <label>
                        <input type="checkbox" id="loadPreviousConversation"> 
                        Load previous conversation on refresh
                    </label>
                    <small>When enabled, previous chat history will appear when you refresh the page</small>
                </div>
                <button class="save-btn" id="saveSettings">Save Settings</button>
            </div>
        </div>

        <!-- Chat Container -->
        <div class="chat-container">
            <div class="chat-messages" id="chatMessages">
                <div class="message bot-message">
                    <div class="message-avatar">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="message-content">
                        <p>Hello! I'm your <strong>EOP/ECM Education Agent</strong>, specialized in helping researchers implement transparent, reproducible research software practices. I can analyze your code, provide ECM-compliant templates, and guide you through Evidence Chain Model principles. I also remember our conversations for better continuity. How can I assist with your research today?</p>
                    </div>
                </div>
                
                <!-- Suggestion Cards -->
                <div class="suggestion-cards" id="suggestionCards">
                    <div class="suggestion-card" onclick="chatBot.sendSuggestion('Can you explain the Evidence Chain Model to me as if I\'m a computer scientist?')">
                        <div class="suggestion-icon">üîó</div>
                        <div class="suggestion-content">
                            <h4>Explain to me</h4>
                            <p>Can you explain the Evidence Chain Model to me as if I'm a computer scientist?</p>
                        </div>
                    </div>
                    
                    <div class="suggestion-card" onclick="chatBot.sendSuggestion('My repository currently contains a Python script and a data file. What should I add next to make it ECM-compliant?')">
                        <div class="suggestion-icon">üõ†Ô∏è</div>
                        <div class="suggestion-content">
                            <h4>Guide me</h4>
                            <p>My repository currently contains a Python script and a data file. What should I add next to make it ECM-compliant?</p>
                        </div>
                    </div>
                    
                    <div class="suggestion-card" onclick="chatBot.sendSuggestion('What are the key differences between replicability and evidentiary sufficiency according to the EOP paper?')">
                        <div class="suggestion-icon">üìö</div>
                        <div class="suggestion-content">
                            <h4>EOP Knowledge</h4>
                            <p>What are the key differences between replicability and evidentiary sufficiency according to the EOP paper?</p>
                        </div>
                    </div>
                    
                    <div class="suggestion-card" onclick="chatBot.sendSuggestion('Can you create an ECM-compliant project template for a machine learning research project?')">
                        <div class="suggestion-icon">üìã</div>
                        <div class="suggestion-content">
                            <h4>Create Template</h4>
                            <p>Can you create an ECM-compliant project template for a machine learning research project?</p>
                        </div>
                    </div>
                    
                    <div class="suggestion-card" onclick="chatBot.sendSuggestion('How do I handle disclosure barriers when implementing ECM in my research?')">
                        <div class="suggestion-icon">üîí</div>
                        <div class="suggestion-content">
                            <h4>Handle Constraints</h4>
                            <p>How do I handle disclosure barriers when implementing ECM in my research?</p>
                        </div>
                    </div>
                    
                    <div class="suggestion-card" onclick="chatBot.sendSuggestion('What does the AlphaFold3 case teach us about research software disclosure?')">
                        <div class="suggestion-icon">üß¨</div>
                        <div class="suggestion-content">
                            <h4>Case Study</h4>
                            <p>What does the AlphaFold3 case teach us about research software disclosure?</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Typing Indicator -->
            <div class="typing-indicator" id="typingIndicator">
                <div class="message-avatar">
                    <i class="fas fa-robot"></i>
                </div>
                <div class="typing-dots">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>

            <!-- File Upload Area -->
            <div class="file-upload-container" id="fileUploadContainer">
                <div class="file-upload-area" id="fileUploadArea">
                    <div class="upload-content">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p>Drop files here or click to upload</p>
                        <small>Supports: PDF, TXT, MD, Images (JPG, PNG), Code files, ZIP archives</small>
                    </div>
                    <input type="file" id="fileInput" multiple accept=".pdf,.txt,.md,.py,.js,.html,.css,.json,.yml,.yaml,.csv,.zip,.jpg,.jpeg,.png,.gif,.bmp">
                </div>
                <div class="uploaded-files" id="uploadedFiles"></div>
            </div>

            <!-- Input Area -->
            <div class="input-container">
                <div class="input-wrapper">
                    <button id="attachBtn" class="attach-btn" title="Attach files">
                        <i class="fas fa-paperclip"></i>
                    </button>
                    <textarea 
                        id="messageInput" 
                        placeholder="Type your message here..." 
                        rows="1"
                    ></textarea>
                    <button id="sendBtn" class="send-btn">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
                <div class="input-actions">
                    <button id="clearBtn" class="action-btn">
                        <i class="fas fa-trash"></i> Clear Chat
                    </button>
                    <div class="status-indicator" id="statusIndicator">
                        <span class="status-dot"></span>
                        <span class="status-text">Ready</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
